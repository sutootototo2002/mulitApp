"use strict";var _index=require("../config/index.js"),_index2=require("../npm/@tarojs/taro-weapp/index.js"),_index3=_interopRequireDefault(_index2);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function formatTime(e){var t=e.getFullYear(),o=e.getMonth()+1,a=e.getDate(),n=e.getHours(),i=e.getMinutes(),l=e.getSeconds();return[t,o,a].map(formatNumber).join("/")+" "+[n,i,l].map(formatNumber).join(":")}function formatNumber(e){return(e=e.toString())[1]?e:"0"+e}function getUserDetail(t){_index3.default.request({url:_index.BASE_URL+"user/detail",data:{},header:{"content-type":"application/json",token:_index.globalData.token}}).then(function(e){t(e)}).catch(function(e){t(e)})}function login(e,t,o,a,n){_index3.default.showLoading({title:"正在登录"}),_index3.default.request({url:_index.BASE_URL+"token/getToken",data:{code:e,encryptedData:t,iv:o},header:{"content-type":"application/json"},method:"GET",success:function(e){if(console.log(e.data),200==e.data.code)_index3.default.hideLoading(),console.log("服务器登录成功"),_index3.default.setStorage({key:"token",data:e.data.data}),_index.globalData.token=e.data.data,_index.globalData.haslogin=!0,a(e);else{console.log(e.code);var t=e.code;_index3.default.hideLoading(),_index3.default.showToast({title:"登录失败，请重试",icon:t,duration:2e3})}},fail:function(e){_index3.default.hideLoading(),_index3.default.showToast({title:"服务器登陆失败，请退出后重新登录",icon:"fail",duration:2e3})}})}function uploadimg(t){var o=t.i?t.i:0,a=t.success?t.success:0,n=t.fail?t.fail:0,i=t.keys?t.keys:"";_index3.default.uploadFile({url:t.url,filePath:t.path[o],name:"file",formData:null,success:function(e){a++,console.log(e),console.log(o);var t=JSON.parse(e.data);i=i.concat(t.data+";"),console.info("keys---:"+i)},fail:function(e){n++,console.log("fail:"+o+"fail:"+n)},complete:function(e){console.log(o),++o==t.path.length?(console.log("执行完毕"+i),console.log("成功："+a+" 失败："+n),_index3.default.hideLoading(),"function"==typeof t.cb&&t.cb(i)):(console.log(o),t.i=o,t.success=a,t.fail=n,t.keys=i,uploadimg(t))}})}module.exports={formatTime:formatTime,login:login,uploadimg:uploadimg,getUserDetail:getUserDetail};