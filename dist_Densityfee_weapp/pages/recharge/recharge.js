"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function o(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}}(),_get=function e(t,a,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,a);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,a,o)}if("value"in n)return n.value;var i=n.get;return void 0!==i?i.call(o):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../config/index.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Recharge=(_temp2=_class=function(e){function i(){var e,t,a;_classCallCheck(this,i);for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];return(t=a=_possibleConstructorReturn(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(n)))).$usedState=["anonymousState__temp3","anonymousState__temp4","anonymousState__temp5","loopArray0","loopArray1","navList","logList","mhhImg","avatar","tempavatar","arrow","ad","del","answer","mm","isMM","fee","curNav","curIndex","realmoney","wishes","ispayvalue","payvalue","curPage","logs","total","hasnext","successboolean","markBoolean"],a.config={navigationBarTitleText:"我的储值"},a.$$refs=[],_possibleConstructorReturn(a,t)}return _inherits(i,_index.Component),_createClass(i,[{key:"_constructor",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"_constructor",this).call(this,e),this.state={mhhImg:_index3.PATH+"/mImages/xydImg.png",avatar:"",tempavatar:"/mImages/tempavator.png",arrow:_index3.PATH+"/mImages/arrow.png",ad:_index3.PATH+"/mImages/ad.png",del:_index3.PATH+"/mImages/gban.png",answer:_index3.PATH+"/mImages/bzzx.png",mm:_index3.PATH+"/mImages/mm.png",isMM:!0,fee:0,curNav:"",curIndex:0,realmoney:0,wishes:[],navList:[],ispayvalue:!1,payvalue:{},curPage:1,logs:[],total:0,hasnext:!0,successboolean:!1,logList:[],markBoolean:!1}}},{key:"componentWillMount",value:function(){console.log("---onload-rechange---"),console.log(this.$router.params),this.setState({avatar:this.$router.params.avatar,fee:this.$router.params.fee}),this.getUserDetail(),this.onloadData()}},{key:"componentDidMount",value:function(){}},{key:"componentDidShow",value:function(){}},{key:"componentDidHide",value:function(){}},{key:"componentDidCatchError",value:function(){}},{key:"onClose",value:function(){console.log("关闭弹出"),this.setState({ispayvalue:!1,markBoolean:!1})}},{key:"onCloseSuccess",value:function(){console.log("关闭成功"),this.setState({successboolean:!1,markBoolean:!1}),this.getUserDetail()}},{key:"onloadData",value:function(){var t=this;_index2.default.showLoading({title:""});var a=this;_index2.default.request({url:_index3.BASE_URL+"recharge/activity",data:{x:"",y:""},header:{"content-type":"application/json"}}).then(function(e){_index2.default.hideLoading(),console.log("getuser:"),console.log(e.data.data),a.setState({navList:e.data.data,curNav:e.data.data[0].activityid,curIndex:0,realmoney:parseFloat(e.data.data[0].fee)+parseFloat(e.data.data[0].giftfee)}),t.getLogs()})}},{key:"getUserDetail",value:function(){var o=this;_index2.default.request({url:_index3.BASE_URL+"user/detail",data:{},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(e){console.log("获取用户信息："),console.log(e);var t=!1;t="1"!=e.data.data.isnopasspay;var a=e.data.data.fee;o.setState({fee:a,isMM:t})}})}},{key:"getLogs",value:function(){var t=this,e=this.state.curPage;this.setState({curPage:e}),_index2.default.request({url:_index3.BASE_URL+"recharge/logs",data:{page:e},header:{"content-type":"application/json",token:_index3.globalData.token}}).then(function(e){console.log("logs是什么鬼"),console.log(e.data.data.data),t.setState({logList:e.data.data.data,total:e.data.total,hasnext:e.data.hasnext})}).catch(function(e){console.log(e)})}},{key:"onCallback",value:function(e){console.log("callback数据recharge"),console.log(e),_index2.default.setStorageSync("usersinfo",e.data)}},{key:"onselectNav",value:function(e){var t=e.currentTarget.dataset.money.activityid,a=e.currentTarget.dataset.money,o=e.currentTarget.dataset.key;console.log(e),console.log(o),this.setState({curNav:t,curIndex:o,ispayvalue:!0,markBoolean:!0,payvalue:a})}},{key:"ongenerateorder",value:function(e){console.log("点击充值"),console.log(e);var a=this,t=e.detail.formId;_index2.default.showLoading({title:""}),_index2.default.request({method:"POST",url:_index3.BASE_URL+"recharge/generateorder",data:{activityid:this.state.curNav,formid:t},header:{"content-type":"application/json",token:_index3.globalData.token}}).then(function(e){console.log("成功"),console.log(e.data);var t=e.data.data.orderid;a.onPay(t)}).catch(function(e){console.log("接口异常"),console.log(e)})}},{key:"updatePayStatus",value:function(e,t){_index2.default.showLoading({title:""}),_index2.default.request({method:"POST",data:{status:e,orderid:t},url:_index3.BASE_URL+"recharge/orderpaystatus",header:{Accept:"application/json",token:_index3.globalData.token}}).then(function(e){console.log("updatePayStatus:"),console.log(e.data),_index2.default.hideLoading()}).catch(function(e){})}},{key:"onPay",value:function(a){console.log("去付款");var o=this;_index2.default.request({method:"POST",data:{orderid:a},url:_index3.BASE_URL+"pay/getPreRechargeOrder",header:{Accept:"application/json","content-type":"application/x-www-form-urlencoded",token:_index3.globalData.token}}).then(function(t){console.log(t.data),_index2.default.hideLoading(),200==t.data.code?_index2.default.requestPayment({timeStamp:t.data.data.timeStamp,nonceStr:t.data.data.nonceStr,package:t.data.data.package,signType:t.data.data.signType,paySign:t.data.data.paySign}).then(function(e){console.log("success",e),_index3.globalData.needrefresh=!0,o.updatePayStatus(1,a),o.onloadData(),o.getUserDetail(),o.setState({ispayvalue:!1,successboolean:!0})}).catch(function(e){console.log(e),console.log("fail",t),o.updatePayStatus(0,a)}):_index2.default.showModal({title:"提示",content:t.data.msg,showCancel:!1})})}},{key:"onAnswer",value:function(){console.log("有疑问请点击这里")}},{key:"onMM",value:function(){}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=this.__state,t=e.navList,a=e.logList,o=(this.__state.fee/100).toFixed(2),n=this.__state.ispayvalue?Number(this.__state.payvalue.fee)/100+Number(this.__state.payvalue.giftfee)/100:null,r=this.__state.successboolean?Number(this.__state.payvalue.fee)/100+Number(this.__state.payvalue.giftfee)/100:null,i=t.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp2:Number(e.$original.fee)/100+Number(e.$original.giftfee)/100,$original:e.$original}}),s=a.map(function(e){var t="";return"1"==(e={$original:(0,_index.internal_get_original)(e)}).$original.logtype&&(t="储值"),"2"==e.$original.logtype&&(t="消费"),"3"==e.$original.logtype&&(t="退款"),"4"==e.$original.logtype&&(t="取现"),{name:t,$original:e.$original}});return Object.assign(this.__state,{anonymousState__temp3:o,anonymousState__temp4:n,anonymousState__temp5:r,loopArray0:i,loopArray1:s}),this.__state}}]),i}(),_class.properties={},_class.$$events=["onselectNav","onClose","onAnswer","ongenerateorder","onCloseSuccess","onMM"],_temp2);exports.default=Recharge,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Recharge,!0));