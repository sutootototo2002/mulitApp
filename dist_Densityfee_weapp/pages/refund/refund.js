"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,$orderid,_createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_get=function e(t,o,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,o);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,n)}if("value"in a)return a.value;var s=a.get;return void 0!==s?s.call(n):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../config/index.js"),_util=require("../../utils/util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Refund=(_temp2=_class=function(e){function s(){var e,t,o;_classCallCheck(this,s);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=o=_possibleConstructorReturn(this,(e=s.__proto__||Object.getPrototypeOf(s)).call.apply(e,[this].concat(a)))).$usedState=["loopArray0","navList","pics","machineImg","id_","value","temp","upload","imagesArr","files"],o.config={navigationBarTitleText:"问题反馈"},o.$$refs=[],_possibleConstructorReturn(o,t)}return _inherits(s,_index.Component),_createClass(s,[{key:"_constructor",value:function(e){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_constructor",this).call(this,e),this.state={machineImg:_index3.PATH+"/mImages/refund.png",navList:[],id_:0,value:"",temp:_index3.PATH+"/mImages/carma.jpg",upload:_index3.PATH+"/mImages/carma.jpg",imagesArr:[],pics:[],files:[]}}},{key:"componentWillMount",value:function(){console.log(this.$router.params),$orderid=this.$router.params.orderid,this.getRefundressons()}},{key:"getRefundressons",value:function(){var t=this;_index2.default.request({url:_index3.BASE_URL+"order/refundressons",data:{orderid:$orderid},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(e){console.log("getDetail:"),console.log(e.data.data),t.setState({navList:e.data.data})}})}},{key:"componentDidMount",value:function(){}},{key:"componentDidShow",value:function(){}},{key:"componentDidHide",value:function(){}},{key:"componentDidCatchError",value:function(){}},{key:"selectNav",value:function(o){console.log(o);var e=this.state.navList.map(function(e,t){return e.id==o?e.selected="true":e.selected="false",e});console.log("temp:"),console.log(e),this.setState({id_:Number(o),navList:e})}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"chooseImage",value:function(e){var i=this;4<=i.state.pics.length?_index2.default.showToast({title:"最多上传四张图片"}):_index2.default.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],count:4-i.state.pics.length,success:function(a){console.log("tempFilePaths:"+a.tempFilePaths),_index2.default.getNetworkType({success:function(e){var t=e.networkType;"unknown"!=t&&"none"!=t?(_index2.default.showLoading({title:"正在上传"}),(0,_util.uploadimg)({url:_index3.BASE_URL+"image/upload",path:a.tempFilePaths,cb:function(e){if(console.log("--res2---"),console.log(e),""!=e){console.log("--res2不为空！");var t=e.split(";");console.log("aftersplists:"),console.log(t),t.splice(t.length-1,1);var o=i.state.files.concat(a.tempFilePaths),n=i.state.pics.concat(t);console.log("ftemp"),console.log(o),console.log("ptemp"),console.log(n),i.setState({files:o,pics:n})}else console.log("--res2空！"),_index2.default.showToast({title:"上传失败"})}})):_index2.default.showToast({title:"未连接网络"})}})}})}},{key:"submitRefund",value:function(e){var t=this;console.log("$orderid: "+$orderid);var o=t.state.navList.filter(function(e,t){if("true"==e.selected)return e});if(console.log("类型选择："+o),console.log(o),0!=o.length){for(var n=o[0].id,a="",i=0;i<t.state.pics.length;i++)a=a+t.state.pics[i]+";";""!=a?(console.log("tmpics(图片选择):"+a),console.log(a),_index2.default.showLoading({title:"努力反馈中"}),console.log("备注："),console.log(t.state.value),_index2.default.request({method:"POST",data:{orderid:$orderid,labels:n,remark:t.state.value,pics:a},url:_index3.BASE_URL+"order/applyrefund",header:{Accept:"application/json",token:_index3.globalData.token},success:function(e){200==e.data.code?(_index2.default.hideLoading(),_index2.default.showModal({title:"反馈成功",content:"客官息怒，您的反馈我们已经收到，小二们抓紧核实处理",showCancel:!1,success:function(e){e.confirm&&_index2.default.redirectTo({url:"/pages/index/index"})}})):(_index2.default.hideLoading(),_index2.default.showModal({title:"提示",content:e.data.msg,showCancel:!1,success:function(e){e.confirm}}))}})):_index2.default.showModal({title:"提示",content:"请至少上传一张图片",showCancel:!1})}else _index2.default.showModal({title:"提示",content:"请选择问题类型",showCancel:!1})}},{key:"_createData",value:function(){var o=this;this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=this.__state,t=e.navList,n=(e.pics,t.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp2:o.__state.id_==Number(e.$original.id)?"btn select":"btn",$loopState__temp4:"ab"+t,$original:e.$original}}));return Object.assign(this.__state,{loopArray0:n}),this.__state}}]),s}(),_class.properties={},_class.$$events=["selectNav","handleChange","chooseImage","submitRefund"],_temp2);exports.default=Refund,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Refund,!0));