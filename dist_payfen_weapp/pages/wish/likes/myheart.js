"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,avatar,lastLon,lastLat,wishid,merchantid,_createClass=function(){function o(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}}(),_get=function e(t,a,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,a);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,a,o)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(o):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../../config/index.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Myheart=(_temp2=_class=function(e){function s(){var e,t,a;_classCallCheck(this,s);for(var o=arguments.length,i=Array(o),n=0;n<o;n++)i[n]=arguments[n];return(t=a=_possibleConstructorReturn(this,(e=s.__proto__||Object.getPrototypeOf(s)).call.apply(e,[this].concat(i)))).$usedState=["myheartList","searLists","otherWishes","machines","globalData","mhhImg","avator","imgs","imgs1","zmkm","clear","value","bool","HearBoolean","HearHead","closebtn","markBoolean","heardImg","addr","dyzh","yyzh","hashOtherWishes","pageNo","pageSize","hasMore","isDel","wish","wishname"],a.config={navigationBarTitleText:"心愿单"},a.$$refs=[],_possibleConstructorReturn(a,t)}return _inherits(s,_index.Component),_createClass(s,[{key:"_constructor",value:function(e){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_constructor",this).call(this,e),this.state={mhhImg:_index3.PATH+"/mImages/xydImg.png",avator:_index3.globalData.avatar?_index3.globalData.avatar:_index3.PATH+"/mImages/tempavator.jpg",imgs:_index3.PATH+"/mImages/xytb.png",imgs1:_index3.PATH+"/mImages/xytb-1.png",zmkm:_index3.PATH+"/mImages/zmkm0.png",clear:_index3.PATH+"/mImages/ljx1.png",value:"",bool:!1,HearBoolean:!1,HearHead:_index3.PATH+"/mImages/ysjtb1.png",closebtn:_index3.PATH+"/mImages/gban1.png",markBoolean:!1,heardImg:_index3.PATH+"/mImages/fkz.png",addr:_index3.PATH+"/mImages/tytb-4.png",dyzh:_index3.PATH+"/mImages/dyz_f.png",yyzh:_index3.PATH+"/mImages/yyz_f.png",searLists:[],myheartList:[],otherWishes:[],hashOtherWishes:[],pageNo:1,pageSize:10,hasMore:!1,isDel:!1,machines:[],wish:"",wishname:""}}},{key:"componentWillMount",value:function(){console.log("-----------onLoad---------"),console.log(this.$router.params),avatar=this.$router.params.avatar,lastLon=this.$router.params.lon,lastLat=this.$router.params.lat,console.log("globalData:"),console.log(_index3.globalData)}},{key:"componentDidMount",value:function(){}},{key:"componentDidShow",value:function(){console.log("---onshow----"),this.ongetHeartList(),this.reset(),this.loadOtherWishes()}},{key:"componentDidHide",value:function(){}},{key:"componentDidCatchError",value:function(){}},{key:"fetchMoreLikes",value:function(){this.state.hasMore&&this.loadOtherWishes()}},{key:"loadOtherWishes",value:function(){var i=this;_index2.default.showLoading({title:""}),_index2.default.request({url:_index3.BASE_URL+"wishlist/otherWishList",data:{pageNo:this.state.pageNo,pageSize:this.state.pageSize},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(e){var t=e.data.rows;console.log("其他小伙伴的心愿单："),console.log(e.data);var a={},o=t.reduce(function(e,t){return!a[t.wishlistid]&&(a[t.wishlistid]=e.push(t)),e},[]);console.log("chatList："),console.log(o),_index2.default.hideLoading(),console.log("pageNo:"),console.log(e.data.pageNo),i.setState({otherWishes:i.state.otherWishes.concat(o),hasMore:e.data.hasMore,pageNo:e.data.pageNo})},fail:function(e){_index2.default.hideLoading(),_index2.default.showToast({title:"请求失败",icon:"fail",duration:2e3})}})}},{key:"reset",value:function(){this.setState({otherWishes:[],hashOtherWishes:[],pageNo:1})}},{key:"onCloseHeard",value:function(){console.log("关闭心愿单"),this.setState({HearBoolean:!1,markBoolean:!1})}},{key:"addgoods",value:function(){console.log("添加商品"),this.setState({bool:!0,isDel:!1})}},{key:"add",value:function(){console.log("添加商品"),this.setState({bool:!1})}},{key:"onSetheart",value:function(){console.log("进入心愿单中心"),_index2.default.navigateTo({url:"/pages/wish/likes/myheart"})}},{key:"oncheckdetail",value:function(e){console.log("查看详情"),console.log(e),console.log("wishid："+e.currentTarget.dataset.wishid),console.log("wishname:"+e.currentTarget.dataset.wishname),wishid=e.target.dataset.wishid,merchantid=e.target.dataset.merchantid?e.target.dataset.merchantid:"",this.setState({HearBoolean:!0,markBoolean:!0,wishname:e.currentTarget.dataset.wishname}),this.loadMachines()}},{key:"loadMachines",value:function(){var t=this;_index2.default.showLoading({title:""}),_index2.default.request({url:_index3.BASE_URL+"wishlist/getWishFeedBacks",data:{wishlistid:wishid,merchantid:merchantid,longitude:_index3.globalData.longitude,latitude:_index3.globalData.lastLon},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(e){console.log("machines:"),console.log(e),_index2.default.hideLoading(),t.setState({machines:e.data.rows,wish:0<e.data.rows.length?e.data.rows[0].wishname:""})},fail:function(e){_index2.default.hideLoading(),t.setState({machines:[]})}})}},{key:"onSearchHandler",value:function(e){console.log(e),this.setState({value:e});var t=this;_index2.default.request({url:_index3.BASE_URL+"wishlist/filterWishes",data:{name:e},header:{"content-type":"application/json",token:_index3.globalData.token},method:"POST"}).then(function(e){200==e.data.code&&(console.log("res.data.rows:"),console.log(e.data.rows),t.setState({searLists:e.data.rows}))})}},{key:"formSubmit",value:function(e){console.log(e),console.log("form")}},{key:"onGoback",value:function(){this.setState({value:"",bool:!1})}},{key:"onInput",value:function(e){console.log(),console.log("添加。。"),console.log(e),e?this.adda(e):_index2.default.showToast({title:"请添加心愿",icon:"fail",duration:2e3})}},{key:"onBlur",value:function(e){console.log("失去焦点。。。。"),console.log(e)}},{key:"adda",value:function(e){var t=this;_index2.default.request({url:_index3.BASE_URL+"wishlist/addWish",data:{name:e},header:{"content-type":"application/json",token:_index3.globalData.token},method:"POST",success:function(e){200==e.data.status?(console.log("添加成功！"),t.setState({bool:!1,value:""}),t.ongetHeartList()):_index2.default.showToast({title:e.data.msg,icon:"fail",duration:2e3})},fail:function(e){_index2.default.showToast({title:"请求失败",icon:"fail",duration:2e3})}})}},{key:"bindconfirm",value:function(e){console.log(e),console.log("bindconfirom")}},{key:"ongetHeartList",value:function(){var a=this;_index2.default.request({url:_index3.BASE_URL+"/wishlist/myWishList",data:{},header:{"content-type":"application/json",token:_index3.globalData.token},method:"POST",success:function(e){console.log("获取心愿列表11111："),console.log(e.data.rows);var t=e.data.rows.map(function(e,t){return e.id=t,e});a.setState({myheartList:t})},fail:function(e){_index2.default.showToast({title:"请求失败",icon:"fail",duration:2e3})}})}},{key:"onModify",value:function(){console.log("修改按钮"),this.setState({isDel:!0})}},{key:"ondelFn",value:function(e){console.log(e),console.log(e.currentTarget.id);var o=e.currentTarget.id,t=e.currentTarget.dataset.type,i=e.currentTarget.dataset.wishlistid,a=e.currentTarget.dataset.wishpraise,n=this;_index2.default.request({url:_index3.BASE_URL+"/wishlist/deleteAWish",data:{type:t,wishlistid:i,wishpraise:a},header:{"content-type":"application/json",token:_index3.globalData.token},method:"POST",success:function(a){if(console.log(a),200==a.data.status){console.log("删除成功！");var e=n.state.otherWishes;e.map(function(e,t){e.wishlistid==i&&(e.extra="0",e.likes=a.data.n)});var t=n.state.myheartList;t.splice(o,1),n.setState({myheartList:t,otherWishes:e})}},fail:function(e){_index2.default.showToast({title:"请求失败",icon:"fail",duration:2e3})}})}},{key:"toBoxdetail",value:function(e){_index2.default.navigateTo({url:"../../box/boxdetail/boxdetail?machineid="+e.currentTarget.dataset.machineid})}},{key:"unlikeit",value:function(e){var o=this,i=(e.currentTarget.dataset.id,e.currentTarget.dataset.wishid),t=this.state.myheartList.find(function(e,t){if(e.wishlistid==i)return e.wishpraise}),a=e.currentTarget.dataset.type;console.log("wishpraise:"),console.log(t.wishpraise),_index2.default.request({url:_index3.BASE_URL+"wishlist/deleteAWish",method:"POST",data:{wishlistid:i,wishpraise:t.wishpraise,type:a},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(a){if(_index2.default.hideLoading(),200==a.data.status){var e=o.state.otherWishes;e.map(function(e,t){return e.wishlistid==i&&(e.extra="0",e.likes=a.data.n),e}),console.log("extra after..."),console.log(e);var t=o.state.myheartList.filter(function(e,t){return e.wishlistid!==i});console.log(t),o.setState({otherWishes:e,myheartList:t})}_index2.default.showToast({title:a.data.msg,icon:200==a.data.status?"success":"none",duration:2e3})},fail:function(e){_index2.default.hideLoading(),_index2.default.showToast({title:"删除失败",icon:"fail",duration:2e3})}})}},{key:"likeit",value:function(e){var o=this;console.log(e);var i=e.currentTarget.dataset.id,t=e.currentTarget.dataset.wishid;console.log("idx:"+i+"wishid:"+t),_index2.default.showLoading({title:""}),_index2.default.request({url:_index3.BASE_URL+"wishlist/likeAWish",method:"POST",data:{wishlistid:e.currentTarget.dataset.wishid},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(a){_index2.default.hideLoading();var e=o.state.myheartList.concat(a.data.rows);console.log("this.state.otherWishes"),console.log(o.state.otherWishes);var t=o.state.otherWishes;t.map(function(e,t){return t==i&&(e.extra="1",e.likes=a.data.n),e}),console.log("extra after..."),console.log(t),o.setState({otherWishes:t,myheartList:e}),_index2.default.showToast({title:"点赞成功",icon:"success",duration:2e3})},fail:function(e){console.log("请求失败:"+e),_index2.default.hideLoading(),_index2.default.showToast({title:"点赞失败",icon:"fail",duration:2e3})}})}},{key:"addWishFn",value:function(e){console.log(e);var t=e.currentTarget.dataset.wishname;this.setState({value:t})}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=this.__state;e.searLists,e.myheartList,e.otherWishes,e.machines;return Object.assign(this.__state,{globalData:_index3.globalData}),this.__state}}]),s}(),_class.properties={},_class.$$events=["ondelFn","addWishFn","unlikeit","likeit","oncheckdetail","toBoxdetail","onModify","addgoods","fetchMoreLikes","onSearchHandler","onInput","onGoback","onCloseHeard"],_temp2);exports.default=Myheart,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Myheart,!0));