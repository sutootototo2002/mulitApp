"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_get=function e(t,o,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,o);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,n)}if("value"in a)return a.value;var s=a.get;return void 0!==s?s.call(n):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../config/index.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var curPage=0,curStatus=8,cardid="",Index=(_temp2=_class=function(e){function s(){var e,t,o;_classCallCheck(this,s);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=o=_possibleConstructorReturn(this,(e=s.__proto__||Object.getPrototypeOf(s)).call.apply(e,[this].concat(a)))).$usedState=["anonymousState__temp","globalData","mhhImg","iconImg1","iconImg2","tytb33","perbox","avator","iconB1","iconB2","iconB21","iconB3","iconB4","iconC1","iconC2","iconC3","iconC4","userInfoList","wishes","isuserInfo","goodsList","total"],o.config={navigationBarTitleText:"个人中心"},o.$$refs=[],_possibleConstructorReturn(o,t)}return _inherits(s,_index.Component),_createClass(s,[{key:"_constructor",value:function(e){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_constructor",this).call(this,e),this.state={mhhImg:_index3.PATH+"/mImages/xydImg.png",iconImg1:_index3.PATH+"/mImages/tytb-1.png",iconImg2:_index3.PATH+"/mImages/tytb-61.png",tytb33:_index3.PATH+"/mImages/tytb-33.png",perbox:_index3.PATH+"/mImages/perbox.png",avator:_index3.PATH+"/mImages/tempavator.png",iconB1:_index3.PATH+"/mImages/wddd-new1-50.png",iconB2:_index3.PATH+"/mImages/wddd-new3-50.png",iconB21:_index3.PATH+"/mImages/wddd-new3-51.png",iconB3:_index3.PATH+"/mImages/wddd-new2-50.png",iconB4:_index3.PATH+"/mImages/wddd-55.png",iconC1:_index3.PATH+"/mImages/zhsz.png",iconC2:_index3.PATH+"/mImages/bzzx.png",iconC3:_index3.PATH+"/mImages/yjfk.png",iconC4:_index3.PATH+"/mImages/wdkf.png",userInfoList:{},wishes:[],isuserInfo:!0,goodsList:[],total:0}}},{key:"componentWillMount",value:function(){this.getUserDetail(),this.getWishList(),this.getOrders(),cardid=this.$router.params.cardid?this.$router.params.cardid:"",console.log("componentDidMount")}},{key:"componentDidShow",value:function(){console.log("componentDidShow"),this.getUserDetail(),this.getWishList(),this.getOrders()}},{key:"componentWillUpdate",value:function(){console.log("componentWillUpdate"),console.log("---------sususu----------")}},{key:"componentDidHide",value:function(){console.log("componentDidHide")}},{key:"componentDidCatchError",value:function(){console.log("componentDidCatchError")}},{key:"getOrders",value:function(){var t=this;_index2.default.showLoading({title:""}),_index2.default.request({url:_index3.BASE_URL+"order/orderlist",data:{page:1,rows:10,status:curStatus,cardid:cardid},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(e){_index2.default.hideLoading(),console.log("订单数据列表："),console.log(e.data.data.data),console.log(e.data.data.total),t.setState({total:e.data.data.total,goodsList:e.data.data.data})}})}},{key:"getUserDetail",value:function(){var t=this;_index2.default.request({url:_index3.BASE_URL+"user/detail",data:{},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(e){console.log("查看用户信息：1111"),console.log(e);null!==e.data.data.avatar?(_index3.globalData.fee=e.data.data.fee,_index3.globalData.nickName=e.data.data.nickname,t.setState({userInfoList:e.data.data,isuserInfo:!1})):t.setState({userInfoList:e.data.data,isuserInfo:!0})}})}},{key:"getWishList",value:function(){_index2.default.showLoading({title:""});var t=this;_index2.default.request({url:_index3.BASE_URL+"wishlist/myWishList",data:{},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(e){_index2.default.hideLoading(),t.setState({wishes:e.data.rows})},fail:function(e){_index2.default.hideLoading()}})}},{key:"gobingcart",value:function(){console.log("绑定亲情卡"),_index2.default.navigateTo({url:"../card/bindcard"})}},{key:"goheart",value:function(){console.log("进入心愿单中心"),_index2.default.navigateTo({url:"../wish/likes/myheart"})}},{key:"toOrders",value:function(){_index2.default.navigateTo({url:"../orders/orderlist/orderlist?state=8&value=0"})}},{key:"toOrders1",value:function(){_index2.default.navigateTo({url:"../orders/orderlist/orderlist?state=8&value=0"})}},{key:"toOrders2",value:function(){_index2.default.navigateTo({url:"../orders/orderlist/orderlist?state=6&value=1"})}},{key:"toOrders3",value:function(){_index2.default.navigateTo({url:"../orders/orderlist/orderlist?state=7&value=2"})}},{key:"userInfoHandler",value:function(e){if(console.log(e.detail.userInfo),null!=e.detail.userInfo){this.setState({isuserInfo:!1}),_index2.default.showLoading({title:""}),_index2.default;var t=this.state.userInfoList;t.avatar=e.detail.userInfo.avatarUrl,_index3.globalData.avatar=t.avatar,t.nickName=e.detail.userInfo.nickname||e.detail.userInfo.nickName,_index3.globalData.nickName=t.nickName,console.log("globalData.nickName"),console.log(_index3.globalData.nickName),this.setState({userInfoList:t}),console.log("userInfoList:"),console.log(this.state.userInfoList),_index2.default.request({method:"POST",url:_index3.BASE_URL+"user/updateuserinfo",data:{avatarUrl:e.detail.userInfo.avatarUrl,city:e.detail.userInfo.city,country:e.detail.userInfo.country,nickName:e.detail.userInfo.nickName,province:e.detail.userInfo.province},header:{"content-type":"application/json",token:_index3.globalData.token},success:function(e){console.log(e),_index2.default.showToast({title:"更新成功",icon:"success",duration:2e3})},fail:function(e){_index2.default.hideLoading()}})}}},{key:"goRecharge",value:function(){_index2.default.navigateTo({url:"/pages/recharge/recharge?avatar="+_index3.globalData.avatar+"&nickname="+_index3.globalData.nickname+"&fee="+_index3.globalData.fee})}},{key:"gohome",value:function(){_index2.default.navigateTo({url:"/pages/index/index"})}},{key:"toSever",value:function(){_index2.default.navigateTo({url:"/pages/service/service"})}},{key:"requestOpen",value:function(e){_index2.default.showLoading({title:""});_index2.default.request({url:_index3.BASE_URL+"device/requestopen",data:{qrurl:e},header:{"content-type":"application/json",token:_index3.globalData.token},method:"POST",success:function(e){if(_index2.default.hideLoading(),console.log("检测是否可以开门"),console.log(e),200==e.data.code){var t=e.data.data.machineid,o=e.data.data.lockid;_index2.default.reLaunch({url:"../box/open/open?machineid="+t+"&lockid="+o+"&formid="})}else 206!=e.data.code&&_index2.default.showModal({title:"提示",content:e.data.msg,showCancel:!1,success:function(e){e.confirm}})},fail:function(e){_index2.default.showToast({title:"请求失败",icon:"fail",duration:2e3})}})}},{key:"onScreen",value:function(){console.log("扫码开门");var t=this;_index2.default.showLoading({title:""}),_index2.default.request({url:_index3.BASE_URL+"device/checkscan",data:{},header:{"content-type":"application/json",token:_index3.globalData.token},method:"POST"}).then(function(e){console.log("扫码是否成功："),console.log(e),_index2.default.hideLoading(),200==e.data.code&&_index2.default.scanCode().then(function(e){console.log(e),console.log(e.result),t.requestOpen(e.result)}).catch(function(e){console.log(e)}),201==e.data.code&&(console.log("您有未结订单"),_index2.default.showToast({title:"您有未结订单",icon:"fail",duration:2e3}),t.gohome()),202==e.data.code&&(console.log("您已被加入黑名单"),_index2.default.showToast({title:"您的帐号异常！",icon:"fail",duration:2e3}),t.gohome()),205==e.data.code&&(console.log("用户未登录"),_index2.default.showToast({title:"用户未登录",icon:"fail",duration:2e3}),t.gohome()),206==e.data.code&&(console.log("请开通支付分"),_index2.default.showToast({title:"请开通支付分",icon:"fail",duration:2e3}),t.gohome())})}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=(this.__state.userInfoList.fee/100).toFixed(2);return Object.assign(this.__state,{anonymousState__temp:e,globalData:_index3.globalData}),this.__state}}]),s}(),_class.properties={},_class.$$events=["userInfoHandler","goRecharge","goheart","gobingcart","toOrders","toOrders1","toOrders2","toOrders3","onScreen","gohome","toSever"],_temp2);exports.default=Index,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Index,!0));